<!doctype html><html lang=en-us><head><title>C++ Invert Map at Compile Time | benpm.github.io</title><meta charset=UTF-8><meta name=language content="en"><meta name=description content="How to invert/reverse/transform a map at compile-time in C++!"><meta name=keywords content="C++ ,unordered_map ,transform ,invert ,reverse ,map"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="C++ Invert Map at Compile Time"><meta name=twitter:description content="How to invert/reverse/transform a map at compile-time in C++!"><meta name=twitter:site content="https://twitter.com/_bpmw"><meta name=twitter:creator content="https://twitter.com/_bpmw"><link rel="shortcut icon" type=image/png href=/favicon.ico><link type=text/css rel=stylesheet href=/css/post.min.fd68fc09501957d4d50fd16b42729a5972a98844a54663cac1689bc03c57ff61.css integrity="sha256-/Wj8CVAZV9TVD9FrQnKaWXKpiESlRmPKwWibwDxX/2E="><link type=text/css rel=stylesheet href=/css/custom.min.9b78f616e8ac401da9a641c1d1f4b297f3a6afe8acf3db27e01ab2e7e355efef.css integrity="sha256-m3j2FuisQB2ppkHB0fSyl/Omr+is89sn4Bqy5+NV7+8="><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/benpm.github.io\/"},"articleSection":"blog","name":"C\u002b\u002b Invert Map at Compile Time","headline":"C\u002b\u002b Invert Map at Compile Time","description":"How to invert\/reverse\/transform a map at compile-time in C\u002b\u002b!","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2021","datePublished":"2021-07-01 15:37:49 -0600 -0600","dateModified":"2021-07-01 15:37:49 -0600 -0600","url":"https:\/\/benpm.github.io\/blog\/how-to-invert\/reverse\/transform-a-map-at-compile-time-in-c\u002b\u002b\/","wordCount":"287","keywords":["C\u002b\u002b","unordered_map","transform","invert","reverse","map","Blog"]}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PPST2B8G8Z"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PPST2B8G8Z")</script></head><body><div class=burger__container><div class=burger aria-controls=navigation aria-label=Menu><div class="burger__meat burger__meat--1"></div><div class="burger__meat burger__meat--2"></div><div class="burger__meat burger__meat--3"></div></div></div><nav class=nav id=navigation><ul class=nav__list><li><div class=nav__item-bg><a href=/>Splash!</a></div><div class=indicator></div></li><li><div class=nav__item-bg><a href=/projects>Projects</a></div><div class=indicator></div></li><li class=active><div class="nav__item-bg active"><a class=active href=/blog>Blog</a></div><div class="indicator active"></div></li><li><div class=nav__item-bg><a href=/music>Music</a></div><div class=indicator></div></li><li><div class=nav__item-bg><a href=https://github.com/benpm/cv/raw/master/benpm_cv.pdf>Résumé [pdf]</a></div><div class=indicator></div></li></ul></nav><main><div class=flex-wrapper><div class=post__container><div class=post><header class=post__header><h1 id=post__title>C++ Invert Map at Compile Time</h1><time datetime="2021-07-01 15:37:49 -0600 -0600" class=post-date>Jul 2021</time></header><article class=post__content><p>Sometimes it&rsquo;s useful to be able to invert a map in C++ to perform reverse lookup. Say you are mapping names to IDs of something:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string, <span style=color:#078;font-weight:700>int</span><span style=color:#555>&gt;</span> stuffMap <span style=color:#555>=</span> {
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;bread&#34;</span>, <span style=color:#f60>100</span>},
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;sword&#34;</span>, <span style=color:#f60>200</span>},
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;lamp&#34;</span>,  <span style=color:#f60>300</span>},
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;clogs&#34;</span>, <span style=color:#f60>400</span>}
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Maybe you have the ID and want to get the name. That&rsquo;s something we can do by reversing the map.
Inserting the reversed pairs in a loop seems like a good solution, but maybe we also want this done at compile-time!
So let&rsquo;s define a function which does this for us, but with an arbitrary function, so we can do any
kind of transformation our hearts desire:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#09f;font-style:italic>//Function which can transform an std::unordered_map of one type to another with a given transform function
</span></span></span><span style=display:flex><span><span style=color:#069;font-weight:700>template</span><span style=color:#555>&lt;</span><span style=color:#069;font-weight:700>typename</span> Kout, <span style=color:#069;font-weight:700>typename</span> Vout, <span style=color:#069;font-weight:700>typename</span> Kin, <span style=color:#069;font-weight:700>typename</span> Vin<span style=color:#555>&gt;</span>
</span></span><span style=display:flex><span>std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>Kout, Vout<span style=color:#555>&gt;</span> transformMap(
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>Kin, Vin<span style=color:#555>&gt;&amp;</span> inMap,
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>function<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>pair<span style=color:#555>&lt;</span>Kout, Vout<span style=color:#555>&gt;</span>(<span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>pair<span style=color:#555>&lt;</span>Kin, Vin<span style=color:#555>&gt;&amp;</span>)<span style=color:#555>&gt;</span> mapfunc)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>Kout, Vout<span style=color:#555>&gt;</span> outMap;
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>for_each(inMap.begin(), inMap.end(),
</span></span><span style=display:flex><span>        [<span style=color:#555>&amp;</span>outMap, <span style=color:#555>&amp;</span>mapfunc] (<span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>pair<span style=color:#555>&lt;</span>Kin, Vin<span style=color:#555>&gt;</span> <span style=color:#555>&amp;</span>p) {
</span></span><span style=display:flex><span>            outMap.insert(mapfunc(p));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> outMap;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can use this function to reverse our <code>stuffMap</code> to allow reverse lookup, all at compile-time:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>int</span>, std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span> revStuffMap <span style=color:#555>=</span> transformMap(stuffMap,
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>function([](<span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>pair<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string, <span style=color:#078;font-weight:700>int</span><span style=color:#555>&gt;&amp;</span> p) {
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>return</span> std<span style=color:#555>::</span>make_pair(p.second, p.first);
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>Let&rsquo;s try it out:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#078;font-weight:700>int</span> <span style=color:#c0f>main</span>() {
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;stuffMap:&#34;</span> <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> <span style=color:#99f>p</span> : stuffMap) {
</span></span><span style=display:flex><span>        std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> p.first <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;:&#34;</span> <span style=color:#555>&lt;&lt;</span> p.second <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>revStuffMap:&#34;</span> <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> <span style=color:#99f>p</span> : revStuffMap) {
</span></span><span style=display:flex><span>        std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> p.first <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;:&#34;</span> <span style=color:#555>&lt;&lt;</span> p.second <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>&mldr;</p><pre tabindex=0><code>stuffMap:
400:clogs
300:lamp
200:sword
100:bread

revStuffMap:
bread:100
sword:200
clogs:400
lamp:300
</code></pre><p><a href=https://replit.com/@_bm/transformmap#main.cpp target=_blank rel="noreferrer noopener">Try it yourself here!</a></p><p>And it doesn&rsquo;t need to stop at reversing a map! You can use any function to transform the input
to the output map. Go crazy!</p></article><ul class=tags__list><li class=tag__item><a class=tag__link href=https://benpm.github.io/tags/c++/>C++</a></li></ul><div class=pagination><a class=pagination__item href=https://benpm.github.io/blog/quadtrees/><span class=pagination__label>Previous Post</span>
<span class=pagination__title>Quadtrees for 2D Games with Moving Elements</span>
</a><a class=pagination__item href=https://benpm.github.io/blog/gol_2/><span class=pagination__label>Next Post</span>
<span class=pagination__title>Multi-State Cellular Automata in WebGL</span></a></div></div></div></div></main><script src=/js/index.min.301a8b0870381bf76b3b5182e8966d363a0474281183439beb024d8b8228fc66.js integrity="sha256-MBqLCHA4G/drO1GC6JZtNjoEdCgRg0Ob6wJNi4Io/GY=" crossorigin=anonymous></script><script src=https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js></script><script src=https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://unpkg.com/prismjs@1.20.0/components/></script><script src=/js/theme_toggle.min.025339a3a1b4da585148643908a1af8cf25db67d22bf12d8bd26e50a4dfc19ac.js integrity="sha256-AlM5o6G02lhRSGQ5CKGvjPJdtn0ivxLYvSblCk38Gaw=" crossorigin=anonymous></script><div id=theme-toggle-button class=invertable onclick=toggleTheme()></div></body></html>