<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>C++ on benpm.github.io</title><link>https://benpm.github.io/tags/c++/</link><description>Recent content in C++ on benpm.github.io</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 01 Jul 2021 15:37:49 -0600</lastBuildDate><atom:link href="https://benpm.github.io/tags/c++/index.xml" rel="self" type="application/rss+xml"/><item><title>C++ Invert Map at Compile Time</title><link>https://benpm.github.io/blog/how-to-invert/reverse/transform-a-map-at-compile-time-in-c++/</link><pubDate>Thu, 01 Jul 2021 15:37:49 -0600</pubDate><guid>https://benpm.github.io/blog/how-to-invert/reverse/transform-a-map-at-compile-time-in-c++/</guid><description>&lt;p&gt;Sometimes it&amp;rsquo;s useful to be able to invert a map in C++ to perform reverse lookup. Say you are mapping names to IDs of something:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-C++" data-lang="C++"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;unordered_map&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;std&lt;span style="color:#555"&gt;::&lt;/span&gt;string, &lt;span style="color:#078;font-weight:bold"&gt;int&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; stuffMap &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#c30"&gt;&amp;#34;bread&amp;#34;&lt;/span&gt;, &lt;span style="color:#f60"&gt;100&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#c30"&gt;&amp;#34;sword&amp;#34;&lt;/span&gt;, &lt;span style="color:#f60"&gt;200&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#c30"&gt;&amp;#34;lamp&amp;#34;&lt;/span&gt;, &lt;span style="color:#f60"&gt;300&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#c30"&gt;&amp;#34;clogs&amp;#34;&lt;/span&gt;, &lt;span style="color:#f60"&gt;400&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Maybe you have the ID and want to get the name. That&amp;rsquo;s something we can do by reversing the map.
Inserting the reversed pairs in a loop seems like a good solution, but maybe we also want this done at compile-time!
So let&amp;rsquo;s define a function which does this for us, but with an arbitrary function, so we can do any
kind of transformation our hearts desire:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-C++" data-lang="C++"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;//Function which can transform an std::unordered_map of one type to another with a given transform function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;template&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;typename&lt;/span&gt; Kout, &lt;span style="color:#069;font-weight:bold"&gt;typename&lt;/span&gt; Vout, &lt;span style="color:#069;font-weight:bold"&gt;typename&lt;/span&gt; Kin, &lt;span style="color:#069;font-weight:bold"&gt;typename&lt;/span&gt; Vin&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;std&lt;span style="color:#555"&gt;::&lt;/span&gt;unordered_map&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;Kout, Vout&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; transformMap(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;unordered_map&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;Kin, Vin&lt;span style="color:#555"&gt;&amp;gt;&amp;amp;&lt;/span&gt; inMap,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;function&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;std&lt;span style="color:#555"&gt;::&lt;/span&gt;pair&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;Kout, Vout&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;(&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;pair&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;Kin, Vin&lt;span style="color:#555"&gt;&amp;gt;&amp;amp;&lt;/span&gt;)&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; mapfunc)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;unordered_map&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;Kout, Vout&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; outMap;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;for_each(inMap.begin(), inMap.end(),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; [&lt;span style="color:#555"&gt;&amp;amp;&lt;/span&gt;outMap, &lt;span style="color:#555"&gt;&amp;amp;&lt;/span&gt;mapfunc] (&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;pair&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;Kin, Vin&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;amp;&lt;/span&gt;p) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; outMap.insert(mapfunc(p));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; );
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; outMap;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can use this function to reverse our &lt;code&gt;stuffMap&lt;/code&gt; to allow reverse lookup, all at compile-time:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-C++" data-lang="C++"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;unordered_map&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;int&lt;/span&gt;, std&lt;span style="color:#555"&gt;::&lt;/span&gt;string&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; revStuffMap &lt;span style="color:#555"&gt;=&lt;/span&gt; transformMap(stuffMap,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;function([](&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;pair&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;std&lt;span style="color:#555"&gt;::&lt;/span&gt;string, &lt;span style="color:#078;font-weight:bold"&gt;int&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&amp;amp;&lt;/span&gt; p) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;make_pair(p.second, p.first);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;rsquo;s try it out:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-C++" data-lang="C++"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#078;font-weight:bold"&gt;int&lt;/span&gt; &lt;span style="color:#c0f"&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;cout &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;stuffMap:&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;endl;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;for&lt;/span&gt; (&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;auto&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;amp;&lt;/span&gt; &lt;span style="color:#99f"&gt;p&lt;/span&gt; : stuffMap) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;cout &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; p.first &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;:&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; p.second &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;endl;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;cout &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#c30;font-weight:bold"&gt;\n&lt;/span&gt;&lt;span style="color:#c30"&gt;revStuffMap:&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;endl;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;for&lt;/span&gt; (&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;auto&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;amp;&lt;/span&gt; &lt;span style="color:#99f"&gt;p&lt;/span&gt; : revStuffMap) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;cout &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; p.first &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;:&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; p.second &lt;span style="color:#555"&gt;&amp;lt;&amp;lt;&lt;/span&gt; std&lt;span style="color:#555"&gt;::&lt;/span&gt;endl;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&amp;hellip;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;stuffMap:
400:clogs
300:lamp
200:sword
100:bread
revStuffMap:
bread:100
sword:200
clogs:400
lamp:300
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;a href="https://replit.com/@_bm/transformmap#main.cpp"
target="_blank" rel="noreferrer noopener"
&gt;Try it yourself here!&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And it doesn&amp;rsquo;t need to stop at reversing a map! You can use any function to transform the input
to the output map. Go crazy!&lt;/p&gt;</description></item></channel></rss>