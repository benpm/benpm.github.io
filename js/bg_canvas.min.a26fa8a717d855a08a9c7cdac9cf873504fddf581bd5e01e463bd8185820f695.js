(function(){const j={light:["#ffffff","#eeeeee","#f7f7f7","#f1f0eb","#ffffff"],dark:["#0f0f0f","#000000","#202020","#0e0e0e","#000000"]};function a(e){const t=parseInt(e.slice(1),16);return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function b(e){return j[e].map(a)}const O={light:a("#f7f7f7"),dark:a("#202020")},_=`#version 300 es
in vec2 a_pos;
void main() { gl_Position = vec4(a_pos, 0.0, 1.0); }`,w=`#version 300 es
precision mediump float;
in  vec3 v_color;
out vec4 fragColor;
void main() {
  vec2  c = gl_PointCoord * 2.0 - 1.0;
  float r2 = dot(c, c);
  if (r2 > 1.0) discard;
  // Sphere depth: push fragments at the center forward, edges back
  float z = sqrt(1.0 - r2);
  gl_FragDepth = gl_FragCoord.z - z * 0.001;
  // Anti-aliased edge
  float d = sqrt(r2);
  float w = fwidth(d);
  float a = 1.0 - smoothstep(1.0 - w, 1.0, d);
  fragColor = vec4(v_color, a);
}`,c=5e4,t=document.createElement("canvas");t.id="bg-canvas",document.body.prepend(t);const e=t.getContext("webgl2");if(!e){t.remove();return}function h(t,n){const s=e.createShader(t);return e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:(console.error(`bg_canvas shader error:
`+e.getShaderInfoLog(s)),e.deleteShader(s),null)}function g(t,n){const o=h(e.VERTEX_SHADER,t),i=h(e.FRAGMENT_SHADER,n);if(!o||!i)return null;const s=e.createProgram();return e.attachShader(s,o),e.attachShader(s,i),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(console.error(`bg_canvas link error:
`+e.getProgramInfoLog(s)),null)}function p(t){return{time:e.getUniformLocation(t,"u_time"),res:e.getUniformLocation(t,"u_res"),palette:e.getUniformLocation(t,"u_palette")}}function y(n){const s=g(_,n);if(!s)return null;const i=e.createVertexArray();e.bindVertexArray(i);const r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW);const a=e.getAttribLocation(s,"a_pos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);const o=p(s);return function(n,a){e.useProgram(s),e.bindVertexArray(i),e.uniform1f(o.time,n),e.uniform2f(o.res,t.width,t.height),e.uniform3fv(o.palette,b(a).flat()),e.drawArrays(e.TRIANGLES,0,6)}}function x(n){const s=g(n,w);if(!s)return null;const i=new Float32Array(c);for(let e=0;e<c;e++)i[e]=e;const a=e.createVertexArray();e.bindVertexArray(a);const l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);const r=e.getAttribLocation(s,"a_id");e.enableVertexAttribArray(r),e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS);const o=p(s);return function(n,i){const r=O[i];e.clearColor(r[0],r[1],r[2],1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(s),e.bindVertexArray(a),e.uniform1f(o.time,n),e.uniform2f(o.res,t.width,t.height),e.uniform3fv(o.palette,b(i).flat()),e.drawArrays(e.POINTS,0,c)}}function f(){t.width=window.innerWidth,t.height=window.innerHeight,e.viewport(0,0,t.width,t.height)}window.addEventListener("resize",f),f();let u="light";new MutationObserver(function(){u=document.body.classList.contains("theme--dark")?"dark":"light"}).observe(document.body,{attributes:!0,attributeFilter:["class"]});let d=!0;document.addEventListener("visibilitychange",function(){d=!document.hidden,d&&requestAnimationFrame(l)});let o=null,i=null;function l(e){i||(i=e),o&&o((e-i)*.001,u),d&&requestAnimationFrame(l)}let n=[],s=0;const r={};function v(e){const t=document.getElementById("shader-toggle-button");if(!t||!n[e])return;const s=t.querySelector("img");s&&(s.src="/svg/"+n[e].icon+".svg")}async function m(e){if(r[e]){o=r[e],v(e);return}const s=n[e],i=await fetch("/shaders/"+s.file).then(e=>e.text()),t=s.type==="frag"?y(i):x(i);t&&(r[e]=t,o=t),v(e)}window.bgCanvas={nextShader:function(){s=(s+1)%n.length,localStorage.setItem("shader",s.toString()),m(s)}};async function C(){n=await fetch("/shaders/shaders.json").then(e=>e.json());const e=parseInt(localStorage.getItem("shader"));if(s=!isNaN(e)&&e>=0&&e<n.length?e:Math.floor(Math.random()*n.length),u=document.body.classList.contains("theme--dark")?"dark":"light",await m(s),!o){t.remove();return}requestAnimationFrame(l)}C().catch(function(e){console.warn("bg_canvas: shader load failed, canvas removed.",e),t.remove()})})()