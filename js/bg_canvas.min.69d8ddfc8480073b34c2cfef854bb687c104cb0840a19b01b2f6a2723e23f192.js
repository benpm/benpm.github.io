(()=>{var e="";(function(){const _={light:["#ffffff","#eeeeee","#f7f7f7","#f1f0eb","#ffffff"],dark:["#0f0f0f","#000000","#202020","#0e0e0e","#000000"]};function r(e){const t=parseInt(e.slice(1),16);return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function m(e){return _[e].map(r)}const C={light:r("#f7f7f7"),dark:r("#202020")},w=`#version 300 es
in vec2 a_pos;
void main() { gl_Position = vec4(a_pos, 0.0, 1.0); }`,O=`#version 300 es
precision mediump float;
in  vec3 v_color;
out vec4 fragColor;
void main() {
  vec2  c = gl_PointCoord * 2.0 - 1.0;
  float r2 = dot(c, c);
  if (r2 > 1.0) discard;
  // Sphere depth: push fragments at the center forward, edges back
  float z = sqrt(1.0 - r2);
  gl_FragDepth = gl_FragCoord.z - z * 0.001;
  // Anti-aliased edge
  float d = sqrt(r2);
  float w = fwidth(d);
  float a = 1.0 - smoothstep(1.0 - w, 1.0, d);
  fragColor = vec4(v_color, a);
}`,l=5e4,n=document.createElement("canvas");n.id="bg-canvas",document.body.prepend(n);const t=n.getContext("webgl2");if(!t){n.remove();return}function y(e,n){const s=t.createShader(e);return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(console.error(`bg_canvas shader error:
`+t.getShaderInfoLog(s)),t.deleteShader(s),null)}function v(e,n){const o=y(t.VERTEX_SHADER,e),i=y(t.FRAGMENT_SHADER,n);if(!o||!i)return null;const s=t.createProgram();return t.attachShader(s,o),t.attachShader(s,i),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?s:(console.error(`bg_canvas link error:
`+t.getProgramInfoLog(s)),null)}function g(e){return{time:t.getUniformLocation(e,"u_time"),res:t.getUniformLocation(e,"u_res"),palette:t.getUniformLocation(e,"u_palette")}}function x(e){const s=v(w,e);if(!s)return null;const i=t.createVertexArray();t.bindVertexArray(i);const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW);const a=t.getAttribLocation(s,"a_pos");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0);const o=g(s);return function(e,a){t.useProgram(s),t.bindVertexArray(i),t.uniform1f(o.time,e/5),t.uniform2f(o.res,n.width,n.height),t.uniform3fv(o.palette,m(a).flat()),t.drawArrays(t.TRIANGLES,0,6)}}function E(e){const s=v(e,O);if(!s)return null;const i=new Float32Array(l);for(let e=0;e<l;e++)i[e]=e;const a=t.createVertexArray();t.bindVertexArray(a);const c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW);const r=t.getAttribLocation(s,"a_id");t.enableVertexAttribArray(r),t.vertexAttribPointer(r,1,t.FLOAT,!1,0,0),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS);const o=g(s);return function(e,i){const r=C[i];t.clearColor(r[0],r[1],r[2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(s),t.bindVertexArray(a),t.uniform1f(o.time,e),t.uniform2f(o.res,n.width,n.height),t.uniform3fv(o.palette,m(i).flat()),t.drawArrays(t.POINTS,0,l)}}function p(){n.width=window.innerWidth,n.height=window.innerHeight,t.viewport(0,0,n.width,n.height)}window.addEventListener("resize",p),p();let h="light";new MutationObserver(function(){h=document.body.classList.contains("theme--dark")?"dark":"light"}).observe(document.body,{attributes:!0,attributeFilter:["class"]});let u=!0;document.addEventListener("visibilitychange",function(){u=!document.hidden,u&&requestAnimationFrame(d)});let i=null,a=null;function d(e){a||(a=e),i&&i((e-a)*.001,h),u&&requestAnimationFrame(d)}let o=[],s=0;const c={};function j(e){const t=document.getElementById("shader-toggle-button");if(!t||!o[e])return;const n=t.querySelector("img");n&&(n.src="/svg/"+o[e].icon+".svg")}async function b(e){if(c[e]){i=c[e],j(e);return}const n=o[e],s=await fetch("/shaders/"+n.file).then(e=>e.text()),t=n.type==="frag"?x(s):E(s);t&&(c[e]=t,i=t),j(e)}const f="shader:"+window.location.pathname;window.bgCanvas={nextShader:function(){s=(s+1)%o.length,localStorage.setItem(f,s.toString()),b(s)}};async function k(){o=await fetch("/shaders/shaders.json").then(e=>e.json());const t=parseInt(localStorage.getItem(f));if(e){const t=o.findIndex(function(t){return t.file===e});s=t>=0?t:0}if(!isNaN(t)&&t>=0&&t<o.length?s=t:window.location.pathname==="/"?s=Math.floor(Math.random()*o.length):s=0,h=document.body.classList.contains("theme--dark")?"dark":"light",await b(s),!i){n.remove();return}requestAnimationFrame(d)}k().catch(function(e){console.warn("bg_canvas: shader load failed, canvas removed.",e),n.remove()})})()})()